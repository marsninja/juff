# Comprehensive juff.toml configuration
# Tests all major configuration options for ruff compatibility

# === Global Options ===
line-length = 100
indent-width = 4
target-version = "py311"
preview = false
fix = true
unsafe-fixes = false
show-fixes = true
output-format = "full"
cache-dir = ".juff_cache"
respect-gitignore = true
force-exclude = false

# Source directories for import resolution
src = ["src", "lib"]

# Additional builtins
builtins = ["_", "gettext"]

# Namespace packages
namespace-packages = ["myapp.plugins"]

# File exclusion patterns
exclude = [
    ".git",
    ".venv",
    "venv",
    "__pycache__",
    "*.egg-info",
    "dist",
    "build",
]

extend-exclude = [
    "migrations/",
    "legacy/",
]

# File inclusion patterns
include = ["*.py", "*.pyi"]
extend-include = ["*.pyw"]

# Per-file target versions
[per-file-target-version]
"scripts/*.py" = "py312"
"legacy/*.py" = "py38"

# === Lint Configuration ===
[lint]
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # pyflakes
    "B",      # flake8-bugbear
    "I",      # isort
    "S",      # flake8-bandit (security)
    "C90",    # mccabe complexity
    "N",      # pep8-naming
    "UP",     # pyupgrade
    "SIM",    # flake8-simplify
    "PTH",    # flake8-use-pathlib
    "RUF",    # ruff-specific
]

ignore = [
    "E501",   # line too long (handled by formatter)
    "S101",   # assert used (acceptable in tests)
    "B008",   # function call in default argument
]

extend-select = ["ANN"]  # Also add type annotations

fixable = ["ALL"]
unfixable = ["F401"]  # Don't auto-remove unused imports

# Preview mode for lint
preview = false
explicit-preview-rules = false

# Task tags for FIX/TD rules
task-tags = ["TODO", "FIXME", "XXX", "HACK", "NOTE"]

# Dummy variable regex for F841
dummy-variable-rgx = "^(_+|(_+[a-zA-Z0-9_]*[a-zA-Z0-9]+?))$"

# External rule codes to preserve
external = ["V"]

# Logger objects for LOG rules
logger-objects = ["logging", "logger", "LOGGER"]

# Typing modules
typing-modules = ["myapp.typing"]

# Allowed confusables
allowed-confusables = ["−", "×"]

# Per-file ignores
[lint.per-file-ignores]
"__init__.py" = ["F401", "F403"]
"tests/**/*.py" = ["S101", "ANN"]
"conftest.py" = ["F401"]
"scripts/*.py" = ["T20"]

[lint.extend-per-file-ignores]
"migrations/*.py" = ["E501"]

# === Plugin Configurations ===

[lint.isort]
known-first-party = ["myapp", "mylib"]
known-third-party = ["requests", "django"]
known-local-folder = ["tests"]
required-imports = ["from __future__ import annotations"]
force-single-line = false
combine-as-imports = true
section-order = [
    "future",
    "standard-library",
    "third-party",
    "first-party",
    "local-folder",
]
lines-after-imports = 2
lines-between-types = 1
force-sort-within-sections = true

[lint.flake8-annotations]
suppress-none-returning = true
suppress-dummy-args = true
mypy-init-return = true
allow-star-arg-any = true

[lint.flake8-bandit]
check-typed-exception = true
hardcoded-tmp-directory = ["/tmp", "/var/tmp"]

[lint.flake8-bugbear]
extend-immutable-calls = ["fastapi.Depends", "fastapi.Query"]

[lint.flake8-builtins]
builtins-ignorelist = ["id", "type"]

[lint.flake8-comprehensions]
allow-dict-calls-with-keyword-arguments = true

[lint.flake8-errmsg]
max-string-length = 50

[lint.flake8-import-conventions]
[lint.flake8-import-conventions.aliases]
numpy = "np"
pandas = "pd"
tensorflow = "tf"

[lint.flake8-import-conventions.banned-aliases]
typing = ["T"]

[lint.flake8-pytest-style]
fixture-parentheses = true
parametrize-names-type = "tuple"
parametrize-values-type = "list"
parametrize-values-row-type = "tuple"
raises-require-match-for = ["ValueError", "TypeError"]
mark-parentheses = true

[lint.flake8-quotes]
inline-quotes = "double"
multiline-quotes = "double"
docstring-quotes = "double"
avoid-escape = true

[lint.flake8-self]
ignore-names = ["_meta"]

[lint.flake8-tidy-imports]
ban-relative-imports = "all"

[lint.flake8-tidy-imports.banned-api]
"typing.TypedDict" = { msg = "Use typing_extensions.TypedDict instead" }

[lint.flake8-type-checking]
strict = true
exempt-modules = ["typing", "typing_extensions"]
runtime-evaluated-base-classes = ["pydantic.BaseModel"]
runtime-evaluated-decorators = ["attrs.define"]

[lint.flake8-unused-arguments]
ignore-variadic-names = true

[lint.mccabe]
max-complexity = 10

[lint.pep8-naming]
classmethod-decorators = ["classmethod", "pydantic.validator"]
staticmethod-decorators = ["staticmethod"]
ignore-names = ["setUp", "tearDown", "setUpClass", "tearDownClass"]

[lint.pycodestyle]
max-line-length = 100
max-doc-length = 88
ignore-overlong-task-comments = true

[lint.pydoclint]
style = "google"

[lint.pydocstyle]
convention = "google"
ignore-decorators = ["typing.overload"]
property-decorators = ["property", "cached_property"]

[lint.pyflakes]
extend-generics = ["myapp.types.Generic"]

[lint.pylint]
max-args = 6
max-branches = 15
max-returns = 8
max-statements = 60
max-public-methods = 25
max-locals = 20
max-nested-blocks = 5
allow-magic-value-types = ["int", "str"]
allow-dunder-method-names = ["__tablename__"]

[lint.pyupgrade]
keep-runtime-typing = true

[lint.ruff]
parenthesize-tuple-in-subscript = true

# === Format Configuration ===
[format]
indent-style = "space"
quote-style = "double"
skip-magic-trailing-comma = false
line-ending = "auto"
docstring-code-format = true
docstring-code-line-length = 80
preview = false

# Format-specific exclusions
exclude = ["generated/"]
